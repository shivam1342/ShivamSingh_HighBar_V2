# Kasparro Agentic FB Analyst Configuration

# Python & Reproducibility
python_version: "3.10"
random_seed: 42

# LLM Configuration - Groq API
# Get free API key from: https://console.groq.com/keys
llm:
  model: "llama-3.3-70b-versatile"
  api_key: ""  # Set environment variable: LLM_API_KEY (recommended)
  temperature: 0.5
  max_tokens: 1500
  timeout: 60  # Request timeout in seconds

# Data Configuration
data:
  csv_path: "synthetic_fb_ads_undergarments.csv"
  use_sample: false
  sample_size: 1000

# Agent Thresholds
thresholds:
  # Global defaults (lowest priority)
  confidence_min: 0.6
  quality_score_min: 0.7
  roas_change_threshold: 0.15
  min_spend_for_analysis: 100
  
  # Per-metric defaults (override global)
  # Priority: campaign-specific > metric-specific > adaptive > global
  metrics:
    ctr:
      default: 0.01
      high_performance_threshold: 0.05   # Top performers
      low_performance_threshold: 0.005   # Bottom performers
    
    cvr:
      default: 0.02
      high_performance_threshold: 0.10
      low_performance_threshold: 0.01
    
    roas:
      default: 1.0
      high_performance_threshold: 2.5
      low_performance_threshold: 0.5
  
  # Per-campaign overrides (highest priority)
  # Example usage: different standards for different campaign types
  campaigns:
    # Uncomment and customize for your campaigns:
    # premium_brand_campaign:
    #   ctr: 0.025    # Premium brands expect higher CTR
    #   roas: 2.0     # Higher ROAS required
    # 
    # clearance_campaign:
    #   ctr: 0.008    # Clearance can have lower CTR
    #   roas: 0.8     # Lower ROAS acceptable
  
  # Historical data-driven thresholds (auto-calculated)
  historical:
    enabled: true
    lookback_days: 30      # Analyze last 30 days
    percentile: 25         # Bottom 25% = underperformers
    min_samples: 100       # Require at least 100 data points
    cache_duration_hours: 24  # Cache for 24 hours
  
  # Evaluator thresholds
  evaluator:
    min_evidence_count: 2
    
    # Adaptive rules: adjust based on data quality
    adaptive:
      # Confidence threshold adjustments
      volatile_confidence_multiplier: 0.7   # Lower for volatile data: 0.6 → 0.42
      stable_confidence_multiplier: 1.2     # Raise for stable data: 0.6 → 0.72
      
      # Quality threshold adjustments
      volatile_quality_multiplier: 0.85     # Lower for volatile: 0.7 → 0.595
      stable_quality_multiplier: 1.1        # Raise for stable: 0.7 → 0.77
      
      # Evidence requirements
      volatile_extra_evidence: 1            # Require more evidence for volatile data
  
  # Planner thresholds (adaptive)
  planner:
    default_underperformer_threshold: 0.01  # For CTR, CVR
    default_roas_threshold: 1.0
    
    # Adaptive rules: adjust based on data quality
    adaptive:
      # When coefficient of variation (CV = std/mean) is high, lower threshold
      high_variance_multiplier: 0.7   # Lower threshold by 30%
      low_variance_multiplier: 1.2    # Raise threshold by 20%
      
      # CV thresholds to trigger adaptation
      high_variance_cv: 0.5   # CV > 0.5 = high variance
      low_variance_cv: 0.2    # CV < 0.2 = low variance

# Output Configuration
outputs:
  reports_dir: "reports"
  logs_dir: "logs"
  insights_file: "reports/insights.json"
  creatives_file: "reports/creatives.json"
  report_file: "reports/report.md"

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "json"
  file: "logs/execution.jsonl"

# Monitoring & Drift Detection
monitoring:
  drift_detection:
    enabled: true
    roas_drop_threshold: 0.5      # Alert if ROAS drops >50%
    ctr_drop_threshold: 0.3       # Alert if CTR drops >30%
    cvr_drop_threshold: 0.3       # Alert if CVR drops >30%
    outlier_std_threshold: 3.0    # Flag values >3 std deviations
    baseline_path: "config/baseline_metrics.json"
  
  alerts:
    enabled: true
    confidence_threshold: 0.5     # Alert if insights have confidence <0.5
    min_data_days: 7              # Alert if no data in last 7 days
    quality_threshold: 0.6        # Alert if quality score <0.6
